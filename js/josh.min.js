(function(a,b){"use strict";var c={};var d=[];var e={};var f;a.US=function(){f=b(this)};a.US.prototype={addCheckin:function(b){d.push(b);e[b.year]=e[b.year]!==undefined?e[b.year]:{};if(c[b.state]===undefined){c[b.state]=new a.State(b.state);e[b.year][b.state]=new a.State(b.state)}else{c[b.state].checkins++;if(e[b.year][b.state]===undefined){e[b.year][b.state]=new a.State(b.state)}else{e[b.year][b.state].checkins++}}f.trigger("checkin",[b,d.length])},sortedStates:function(a){var b=[];for(var c in a){if(a[c].name!==undefined){b.push(a[c])}}b.sort(function(a,b){return b.checkins-a.checkins});return b},getAll:function(){return this.sortedStates(c)},getAllYears:function(){var a=[];for(var b in e){a.push(b)}return a},getYear:function(a){if(e[a]!==undefined){return this.sortedStates(e[a])}},getCheckins:function(a){if(!a){return d.length}else{var b=[];for(var c=0;c<d.length;c++){if(d[c].year===a){b.push(d[c])}}return b.length}}}})(window.Josh=window.Josh||{},window.jQuery);(function(a){"use strict";var b;var c;var d;var e;a.AC=function(){this.USModel=new a.US;this.fb=new a.FB(this.USModel);this.fs=new a.FS(this.USModel);this.svg=new a.SVG;b=this;c=$("#info");d=$("#years");e=$("#alert");$(this.fb).on("checkinDone",function(){b.checkinDone()});$(this.fb).on("checkinStart",function(){b.addAlert("Getting states from Facebook...")});$(this.fs).on("checkinDone",function(){b.checkinDone()});$(this.fs).on("checkinStart",function(){b.addAlert("Getting states from Foursquare...")});$(this.USModel).on("checkin",function(a,d,e){c.append("<li>"+d.name+" "+d.state+" on "+d.date+"</li>");if(e%4===0){b.addAlert("Processing "+d.state)}});$("#years").on("click","li",function(a){var c;if(a.target.innerHTML==="All"){c=b.USModel.getAll()}else{c=b.USModel.getYear(a.target.innerHTML)}b.svg.clearAll();for(var d=0;d<c.length;d++){b.svg.addState(c[d].name,c[d].checkins)}})};a.AC.prototype={addAlert:function(a){e.html(a).removeClass("none")},removeAlert:function(){e.addClass("none")},checkinDone:function(){var a=this.USModel.getAll();for(var b=0;b<a.length;b++){this.svg.addState(a[b].name,a[b].checkins)}var c=this.USModel.getAllYears();var e="<li>All</li>";for(var f=0;f<c.length;f++){e+="<li>"+c[f]+"</li>"}d.html(e);this.removeAlert()}}})(window.Josh=window.Josh||{},window.jQuery);(function(a){"use strict";var b;a.SVG=function(){b=$("svg")};a.SVG.prototype={addState:function(a,c){b.children("#"+a).attr("class","white-state");b.children("#"+a).attr("checkins",c)},clearAll:function(){$("svg path, svg g").removeAttr("class")}}})(window.Josh=window.Josh||{},window.jQuery);(function(a){"use strict";a.State=function(a){this.name=a;this.checkins=1}})(window.Josh=window.Josh||{});(function(a){"use strict";var b;var c;var d;var e;var f=false;a.FB=function(a){b=a;c=$(this);d=this;FB.init({appId:"206649819466252",status:true,cookie:true,oauth:true,xfbml:true});$("#fb_connect").on("click",function(){if(!f){d.getCheckins()}})};e=function(){FB.api("me/checkins?limit=750",function(d){for(var e in d.data){var g=new Date(d.data[e].created_time);b.addCheckin(new a.Place(d.data[e].place.location.latitude,d.data[e].place.location.longitude,d.data[e].place.location.state,d.data[e].place.name,g,g.getFullYear(),"fb"))}f=true;c.trigger("checkinDone")})};a.FB.prototype={getCheckins:function(){c.trigger("checkinStart");FB.getLoginStatus(function(a){if(a.status==="connected"){e()}else{FB.login(function(a){if(a.status==="connected"){e()}},{scope:"email,user_checkins,user_status"})}})}}})(window.Josh=window.Josh||{},window.jQuery);(function(a){"use strict";var b;var c;var d;var e;var f=false;a.FS=function(a){e=a;c=$(this);d=this;this.wireEvents()};a.FS.prototype={wireEvents:function(){$("#fs_connect").on("click",function(){if(!f){c.trigger("checkinStart");window.open("https://foursquare.com/oauth2/authenticate?client_id=TZGGYQQPLXGWT2DZA5UQU3XRDZPZVSRAMOB5E3P0IN31YRV0&response_type=token&redirect_uri=http://ejosh.co/demos/usmap/fstoken.html","","width=500,height=500")}});$(window).on("login",function(a,c){b=c;d.getFourSquare(0,1)})},getFourSquare:function(g,h){if(b===undefined){return}g=g===undefined?0:g;h=h===undefined?1:h;$.getJSON("https://api.foursquare.com/v2/users/self/checkins?v=20120806&limit=250&offset="+g+"&oauth_token="+b,function(b){var i=b.response.checkins.items;h=b.response.checkins.count;for(var j in i){if(i[j].venue!==undefined){var k=new Date(i[j].createdAt*1e3);e.addCheckin(new a.Place(i[j].venue.location.lat,i[j].venue.location.lng,i[j].venue.location.state,i[j].venue.name,k,k.getFullYear(),"fs"))}}if(h>g+250){d.getFourSquare(g+250,h)}else{f=true;c.trigger("checkinDone")}})}}})(window.Josh=window.Josh||{},window.jQuery);(function(a){"use strict";var b={ALASKA:"AK",ALABAMA:"AL",ARKANSAS:"AR",ARIZONA:"AZ",CALIFORNIA:"CA",COLORADO:"CO",CONNECTICUT:"CT",DELAWARE:"DE",FLORIDA:"FL",GEORGIA:"GA",HAWAII:"HI",IOWA:"IA",IDAHO:"ID",ILLINOIS:"IL",INDIANA:"IN",KANSAS:"KS",KENTUCKY:"KY",LOUISIANA:"LA",MASSACHUSETTS:"MA",MARYLAND:"MD",MAINE:"ME",MINNESOTA:"MN",MISSOURI:"MO",MISSISSIPPI:"MS",MONTANA:"MT","NORTH CAROLINA":"NC","NORTH DAKOTA":"ND",NEBRASKA:"NE","NEW HAMPSHIRE":"NH","NEW JERSEY":"NJ","NEW MEXICO":"NM",NEVADA:"NV","NEW YORK":"NY",OHIO:"OH",OKLAHOMA:"OK",OREGON:"OR",PENNSYLVANIA:"PA","RHODE ISLAND":"RI","SOUTH CAROLINA":"SC","SOUTH DAKOTA":"SD",TENNESSEE:"TN",TEXAS:"TX",UTAH:"UT",VIRGINIA:"VA",VERMONT:"VT",WASHINGTON:"WA",WISCONSIN:"WI","WEST VIRGINIA":"WV",WYOMING:"WY"};a.Place=function(a,c,d,e,f,g,h){this.lat=a;this.lng=c;if(d!==undefined){if(d.length>2){this.state=b[d.toUpperCase()]}else{this.state=d.toUpperCase()}}this.name=e;this.date=f;this.year=g;this.type=h}})(window.Josh=window.Josh||{})